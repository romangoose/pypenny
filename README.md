Версия 2023-02-23
# Quick start

`python3 demo.py demo.bat`

>>If 7 dozens miles, 10,500 yards, and 180 feet
>>were covered in 1 hour and 30 minutes,
>>how many miles would be covered
>>in 3/4 of an hour?

>input:

>>`>>= 7 dozen*mile, 10500 yard, 180 foot`

>>`7.0/1 dozen*mile, 10500.0/1 yard, 180.0/1 foot`

>>`>>/ 1 hour, 30 min`

>>`0.7/90 dozen*mile/min, 116.2/3 yard/min, 2.0/1 foot/min`

>>`>>* 3/4 hour`

>>`0.7/120 hour*dozen*mile/min, 87.1/2 hour*yard/min, 1.1/2 hour*foot/min`

>>`>>conv mile`

>>`not converted:  0.0/1`

>>`45.0/1 mile`

>enjoy

# Смешанные числа
# Mixed radix numeral systems 

Смешанные числа - это числа, записанные в **смешанной системе счисления**.

Наиболее известная смешанная система: запись периодов времени в виде чисел:

>>`12 hour, 59 min, 30 sec`

Но это может быть и запись каких-то других величин в неметрической системе:

>>`6 foot, 6 inch (6 фут,  6 дюйм)`

Коротко: в смешанной записи отдельные части числа находятся в недесятичном соотношении друг с другом,
что в общем и является главным затруднением при расчетах.

>##Лирическое отступление:
>>— Теперь давайте сочтем, сколько у нас всего. Портос?

>> — Тридцать экю.

>> — Арамис?

>> — Десять пистолей.

>> — У вас, д'Артаньян?

>> — Двадцать пять.

>> — Сколько это всего? — спросил Атос.

>> — Четыреста семьдесят пять ливров! — сказал д'Артаньян, считавший, как Архимед

>С детства было загадкой, какие расчеты произвел д'Артаньян - 
>и был ли он прав?

>Давайте проверим:

>(Понадобится подгрузить таблицу соотношений для старой французской денежной системы)

>>`>>rate conf/france.tab`

>считаем:

>>`>>=30 экю, 10 пистоль, 25 пистоль`

>>`30.0/1 экю, 35.0/1 пистоль`

>>`>>conv ливр`

>>`not converted:  0.0/1`

>>`475.0/1 ливр`

>Вывод: автор не иронизирует над героем, тот действительно неплохо считает,
*если допустить*, что он оперировал вполне конкретным соотношением между ливром и монетами,
действовавшим в некоторое конкретное время
(с точными соотношениями у старинных валют все было очень сложно).

# Базовые операции
# Base operations

А теперь сразу забудем, что смешанное число записано в какой-то *системе*
(то есть, о том, что его части вообще находятся в каких-то известных соотношениям друг с другом).

Большую часть времени смешанное число ничего не знает о порядке и соотношениях составлящюих его элементов
и может состоять из абсолютно произвольных единиц.

Вполне корректными смешанными числами являются, например:

>>`12 hour, 6 foot, 7 litre`

или даже

>>`3 яблоко, 2 ёж, 1 то-чаво-на-белом-свете-воопче-не-может-быть`

причем, в пределах данного readme мы никогда не установим соотношения между ежами, яблоками и упомянутой сказочной НЁХ.

Тем не менее, такие смешанные числа можно
### складывать (и вычитать) с другим смешанным числом.
### Addition of mixed numbers

>>`>>= 10 hour, 60 min`

>>`10.0/1 hour, 60.0/1 min`

>>`>>+ 5 min, -300 sec, 1 hour`

>>`11.0/1 hour, 65.0/1 min, -300.0/1 sec`

>>`>>- 12 hour, -62 min, 90 sec`

>>`-1.0/1 hour, 127.0/1 min, -390.0/1 sec`

>(Обратите внимание, что в слагаемом и вычитаемом присутствуют отрицательные части).

Можно понять, что порядок частей в смешанном числе не важен
(в общем случае делается попытка поддержать тот порядок, в котором число было введено первоначально),
а также то, что вычисления производятся с каждой частью числа отдельно и независимо.

Не производится никаких попыток перенести числа между разрядами - 
это сознательно выбранное поведение для смешанного числа.
Таким образом можно складывать и вычитать смешанные числа, не задумываясь о соотношении между отдельными его частями:
как минимум, одноименные части будут складываться независимо друг от друга.

А вот чтобы привести число к "каноническому" виду - нам понадобится конвертация:

>>`>>conv hour, min, sec`

>>`not converted:  0.0/1`

>>`1.0/1 hour, 30.0/1 sec`

>обратите внимание, что порядок перечисления желаемых единиц для конверации - важен
(желание пользователя конвертировать именно в таком порядке - закон):

>>`>>conv min, hour`

>>`not converted:  0.0/1`

>>`60.0/1 min, 0.1/120 hour`


но подробно о конвертации - ниже.

Смешанные числа можно также просто
### умножать и делить на обычные числа -
### Multiplication (division) of mixed numbers by a regular number
то есть, увеличивать и уменьшать все его части в какое-то число раз:

>>`>>*3.1/2`

>>`210.0/1 min, 0.7/240 hour`

>>`>>/3.5`

>>`60.0/1 min, 0.1/120 hour`

Предельно просто.

Можно *сначала* ввести обычное число (если не указана никакая единица - то число обычное, *безразмерное*):

>>`>>=3.1/2`

>>`3.1/2`

>или так (ввод дроби в десятичном формате):

>>`>>=3.5`

>>`3.1/2`

и затем умножать на смешанное:

>>`>>*60 min, 1/120 hour`

>>`210.0/1 min, 0.7/240 hour`

Результат такого умножения, как следует из свойства коммутативности, не изменится.

(С делением, очевидно, все не так просто, поэтому вначале рассмотрим

## перемножение и деление смешанных чисел между собой
## Multiplying (dividing) mixed numbers with each other

Смешанное число не только *смешанное*, оно еще и именное, *размерное*
(имеет размерность в физическом смысле).
Поэтому при перемножении смешанных чисел будет происходить также 
и перемножение их размерностей, что приведет к появлению "других" чисел,
в физическом смысле означающих совсем не то,
что означали исходные множители.

Например, 1 час, умноженный на 1-го человека даст 1 человеко-час

>>`>>= 1 hour`

>>`1.0/1 hour`

>>`>>* 1 person`

>>`1.0/1 person*hour`

1 метр, умноженный на 1 метр, даст... квадратный метр? (почти):

>>`>>= 1 m`

>>`1.0/1 m`

>>`>>*1 m`

>>`1.0/1 m*m`


Деление на смешанное число также приводит к новым размерностям:

>>`>>= 90 km`

>>`90.0/1 km`

>>`>>/ 1.1/2 hour`

>>`60.0/1 km/hour`

Последовательные умножения и деления будут приводить к появлению более и более сложных единиц,
причем, самостоятельно эти единицы никак не будут сокращаться или приводиться к другим:

>>`>>=1 person*hour`

>>`1.0/1 person*hour`

>>`>>/2 person`

>>`0.1/2 person*hour/person`

>или

>>`>>=1 person*hour`

>>`1.0/1 person*hour`

>>`>>/0.1/2 hour`

>>`2.0/1 person*hour/hour`

>или 

>>`>>=60 km/hour`

>>`60.0/1 km/hour`

>>`>>*2 hour`

>>`120.0/1 hour*km/hour`

Назовем такое поведение принципом *максимального сохранения первоначального ввода*. 
По разным, ведомым только пользователю, причинам, может быть потребно оставлять производные единицы в исходном виде, 
а все преобразования производить только по непосредственному запросу.

Частично (с помощью команды **fold**) смешанное число может справиться c приведением результата к осмысленному виду
(к упрощению производной единицы) -
"самостоятельно", без "знания" о соотношениях единиц между собой
(фактически, будут свернуты степенные показатели каждой элементарной части, 
и те части, степень которых окажется нулевой, будут удалены):

В итоге, для наших примеров получим:
>время:

>>`>>=0.1/2 person*hour/person`

>>`0.1/2 person*hour/person`

>>`>>fold`

>>`0.1/2 hour`

>людей:

>>`>>=2 person*hour/hour`

>>`2.0/1 person*hour/hour`

>>`>>fold`

>>`2.0/1 person`

>километры:

>>`>>=120 hour*km/hour`

>>`120.0/1 hour*km/hour`

>>`>>fold`

>>`120.0/1 km`

>квадратные метры:

>>`>>= 1 m*m`

>>`1.0/1 m*m`

>>`>>fold`

>>`1.0/1 m:2`

Премножать между собой можно любые смешанные числа - без ограничений. 
В процессе могут получаться многоэтажные и не совсем очевидные конструкции из элементарных единиц - 
но как понятно из примера с командой fold, в этом нет ничего страшного.

Что касается деления - то с ним, по прежнему, все еще не так просто.

Делить можно только на такое смешанное число, 
которое имеет в своем составе только один элемент, одну единицу измерения.
Или может быть приведено к такой одной единице.

То есть, необходима

## Конвертация
## Conversion

# ВЕРСИЯ 2023-02-18

Если задать соотношения между единицами, можно приводить числа к удобному представлению:

    27 час, 62 мин  -15 сек
    =
    28 час,  1 мин,  45 сек

или переводить их в другие единицы

    1.8 фут, 1.8 дюйм
    =
    0.59436 метра

но конвертация позволяет еще и кое-что другое.



#### использование составных единиц

(на примере лошадиной силы, соотносящейся с ваттом, 
который последовательно выражается через джоули, ньютоны -
пока не превращается в набор базовых килограммов, метров и секунд).
Посчитана сила, как результат деления мощности на скорость 
(скорость для большей интриги выражена в узлах):

    >>=1hp
    1.0/1 hp
    >>/1kn
    1.0/1 hp/kn
    >>conv
    735.399/800 hr*кг*м*метр/n.mile*с:2*секунда
    >>fold
    1429.2575/3704 кг*м/с:2
    >>conv N
    not converted:  0.0/1
    1429.2575/3704 N
    >>dec
    1429.6951943844492 N

## А что с делением?

Вообще, полноценное деление на смешанное число 
также должно приводить к появлению новых размерностей,
и можно также прийти к выводу, что такая операция *запрещена*.

Но поскольку ранее мы определили операцию умножения смешанного числа на обычное, 
результатом которого является число смешанное,
то мы должны определить и обратные операции.

Одна из них уже определена - 
при делении смешанного числа на обычное число - получается смешанное число.

Вторая операция должна позволять делить смешанное число на смешанное
и получать в итоге число обычное.
Фактически, отвечать на вопрос, **сколько раз** одно смешанное число **"помещается"** в другом.

Вот здесь как раз конвертация и оказывается нужной:
правильно поделить часы на секунды возможно только если задано отношение секунд к часам.

Хотя, вовсе не обязательно, чтобы **все** единицы смешанного числа имели соотношение друг с другом.
Какое-то число раз в делимом может помещаться весь набор единиц делителя. 
Безусловно, часто будет встречаться ситуация, когда "разноименность" единиц делимого и делителя будет приводить к невозможности полного деления - 
и в этом случае наше деление будет похоже на деление с остатком.

С той разницей, что результат не обязательно будет целочисленный,
но обязательно безразмерный (обычное число),
а в остаток будут помещаться нераспределившиеся размерности.

## О сравнимости чисел

Говорить о сравнении смешанных чисел друг с другом и с нулем в частности
однозначно не получится.

Говорить о положительности или отрицательности смешанного числа
(о сравнимости с нулем),
по-видимому, совсем не приходится.

Как минимум, если части числа не соотносятся между собой - мы ничего не можем сказать о его общем знаке.

И даже если все части числа могут быть приведены к одной единице - 
мы можем говорить о ее знаке только с тем уточнением, 
что этот вывод делается только для текущего состава соотношений.

Ряд размерностей всегда может быть расширен новым соотношением, 
и не исключено, что это соотношение будет отрицательным.

Примерно по тем же соображениям, в общем, невозможно говорить 
об абсолютной сравнимости чисел между собой.

Однако, с допущением  - "для текущего состояния" -
можно делать такие попытки.

В этом случае, часть сравнений, даже для несоотносящихся между собой единиц,
может дать определенный результат:
1. оно смешанное число может быть равным другому, если
    1. все его единицы могут быть приведены к одному набору единиц
    2. численные значения соответствующих частей результатов буду равны
2. число может быть больше или меньше другого, 
если все его части находятся "по одну сторону" (положительную или отрицательную)
от соответствующих частей другого числа.

В остальных случаях, к сожалению, результат сравнения не определен.

# Использование демо

Демо представляет собой простой однорегистровый калькулятор с последовательным вводом.

Чтобы начать вычислять,
вводите числа, используя формат представления дробей

(испольуются настройки, указанные в файле `demo.bat`)

## Сложение:

    >>=12hr,59min,30sec
    12.0/1 hr, 59.0/1 min, 30.0/1 sec
    >>+ 1 hr, 5 min, -40sec
    13.0/1 hr, 64.0/1 min, -10.0/1 sec
    >>- - 14 hr , 2     min    ,   5 sec
    27.0/1 hr, 62.0/1 min, -15.0/1 sec

если представление не очень удобно, проведите конвертацию:

    >>conv hr, min, sec
    28.0/1 hr, 1.0/1 min, 45.0/1 sec

	
состав и порядок, в котором задаются единицы при конвертации, важен

    >>conv min, hr
    1681.0/1 min, 0.1/80 hr

## Умножение:

    >>=6 фут, 6 дюйм
    6.0/1 фут, 6.0/1 дюйм
    >>*3
    18.0/1 фут, 18.0/1 дюйм
    >>/10
    Остаток:  0.0/1
    1.4/5 фут, 1.4/5 дюйм

результат можно представить в десятичном виде

    >>dec
    1.8 фут, 1.8 дюйм

и просто в привычных метрах

    >>conv m
    0.14859/25000 m
    >>dec
    0.59436 m

## Деление на смешанное число:

>>Обратите внимание, для деления здесь использована двойная косая черта //

разложим наши 6 футов и 30 экю
в наборы по 4 экю и 2 фута

(замечу, что я по прежнему ничего не знаю о соотношении экю и фунта;
более того, демонстрационные настройки (`demo.bat`) - ничего не знают об экю)

    >>=6 фут, 30 экю
    6.0/1 фут, 30.0/1 экю
    >>//4 экю, 2 фут
    Остаток:  18.0/1 экю
    3.0/1

итого три набора.

проверка:

    >>*4экю, 2 фут
    12.0/1 экю, 6.0/1 фут
    >>+18экю
    30.0/1 экю, 6.0/1 фут

    >>comp 6фут,30экю
    6.0/1 фут, 30.0/1 экю
    Числа равны

Кстати, что там с оплатой легионеров?

(здесь понадобятся настройки из `money.bat`)

Общая численность войска мне неизвестна, но в общем, можно сказать, что всадник обходится в:

    >>=1 денарий
    1.0/1 денарий
    >>//3.1/3 асс    
    Остаток:  0.0/1
    4.4/5

раза дороже обычного воина.

# О комбинаторике

Главная часть конвертера - таблица соотношений между единицами.
Каждое новое соотношение встравивает очередную единицу в один из сетов (рядов, линеек) единиц
и задает производные соотношения новой единицы со всеми прочими единицами сета.
Таким образом, для исходной линейки связанных между собой единиц длины N
будет задано N(N-1) = N^2^-N производных записей 
(исключаются записи соотношения единицы между самой собой).

# Состав проекта

Главная часть:

`mixednum.py` классы для работы со смешанными числами (само число и конвертер)

`mixedstr.py` класс для преобразования в/из строки

классы смешанных чисел используют соответствующие классы для работы с рациональными дробями:

`rationals.py` сами рациональные дроби

`ratiostr.py` строковое преобразование

необходимы для демо:

`simpleini.py`

`simpletab.py`

`fracdemo.py` демо-калькулятор дробей

(запуск:

    fracdemo.py ./conf/frac.cfg
)

`demo.py` основное демо

пакетные файлы команд для `demo.py`:

`demo.bat` - подключаются разнообразные единицы времени, 
стандартные и экзотические, 
очень большие (индуистский цикл Вселенной = 622080 млрд.лет) 
и очень маленькие (~~древне-еврейское мгновение *регаим* 5/114~~
терция 1/60 секунды);
а также единицы длины (метр, световой год и британская шкала)

`money.bat` - пистоли и гинеи, сестерции и тетрадрахмы, и *деньги* с алтынами

в каталоге `conf` отдельные файлы `*.tab` с таблицами соотношений.

# PS

Этот проект  исходно написан на другом языке. Порт на Python делается в целях обучения Python'у.

В частности, это объясняет то, что для работы с дробями написан свой свой собственный модуль вместо использования готового fractions:
в языке исходного проекта готовый модуль отсутствовал, пришлось писать самостоятельно;
а при переносе на python жаль было терять материал для обучения.
