Версия 2023-02-18
# Quick start

`demo.py demo.bat`

input

    >>=  12 hr, 59 min,  30 sec
    >>+   1 hr,  5 min, -40 sec
    >>- -14 hr,  2 min,   5 sec
    >>conv hr, min, sec

enjoy

# Смешанные числа

Смешанные числа - это числа, записанные в **смешанной системе счисления**.

Наиболее известная смешанная система: запись периодов времени в виде чисел:

    12 час, 59 мин, 30 сек

Но это может быть и запись каких-то других величин в неметрической системе:

    6 футов, 6 дюймов
    

>(
>Лично меня в детстве 
>при чтении "Трех мушкетеров" 
>привлекала идея оперировать суммами вроде `30 экю, 35 пистолей` 
>также быстро как д'Артаньян, который считал как Архимед
>(итого `475 ливров`)

>или свободно ориентироваться в викторианских фунтах, шиллингах и пенсах 
>вместе с Шерлоком Холмсом и доктором Ватсоном;

>или быстро посчитать, сколько сестерциев необходимо на оплату римских легионов
>при условии, 
>что простой легионер рассчитывает в день на 3 1/3 асса,
>а вот всадник - уже на целый денарий.
>)

Итак, коротко: в смешанном числе отдельные его части находятся в недесятичном соотношении друг с другом,
что в общем и является главным затруднением при расчетах.

# Основные операции

Смешанные числа можно
### складывать и вычитать с другим смешанным числом.

     12 час, 59 мин,  30 сек
    +
      1 час,  5 мин, -40 сек
    -
    -14 час, 2 мин,   5 сек
    =
     27 час, 62 мин  -15 сек

Ответ, конечно, можно привести к более привычному виду,
но вообще, он уже является вполне корректным смешанным числом.

Таким образом, можно складывать и вычитать смешанные числа, не задумываясь о соотношении между отдельными его частями:
как минимум, одноименные части будут складываться независимо друг от друга.

Смешанные числа можно также просто
### умножать и делить на обычные числа -
то есть, увеличивать и уменьшать все его части в какое-то число раз

        6 футов, 6 дюймов
     *  3
    =  18 футов, 18 дюймов
     / 10
    = 1.8 футов, 1.8 дюймов

Итак, складывать и умножать (на обычные числа) можно вполне абстрактное смешанное число, которое ничего "не знает"
ни о соотношении между своими частями, ни о взаимном порядке единиц.

Да их может и не быть вовсе.

    6 футов, 30 экю

как и

    30 экю,  6 футов

вполне себе корректное смешанное число.

Кроме того, оно не вполне бессмысленное, как может показаться:

Вполне возможно, что соотношение между футами и экю существует
(например, если речь идет о футах какой-то ткани на продажу),
но нам оно пока не известно.

Тем не менее, первое, что приходит в голову при взгляде на подобные числа после нескольких операций с ними,
это, все-таки, 

## Конвертация

Если задать соотношения между единицами, можно приводить числа к удобному представлению:

    27 час, 62 мин  -15 сек
    =
    28 час,  1 мин,  45 сек

или переводить их в другие единицы

    1.8 фут, 1.8 дюйм
    =
    0.59436 метра

но конвертация позволяет еще и кое-что другое.

Для начала, придется прийти к выводу, что, к сожалению, 

## Нельзя перемножать смешанные числа.

Смешанное число не только *смешанное*, оно еще и именное, *размерное*
(имеет размерность в физическом смысле).
При попытке перемножить два смешанных числа,
мы будет вынуждены перемножить также и их исходные размерности, 
что приведет к появлению "других" чисел,
означающих совсем не то,
что означали исходные множители.

>(
>Вообще, это возможно, но в рамки данного проекта не входит.
>
>При подсчете экю и пистолей д'Артаньян не покидал размерность ливров
>и не переходил к мушкетеро*пистолям - *и я не буду*.
>)

### **UPD** Сие неверно. Пока readme не переписан:

#### вот краткая демонстрация умножения и деления с использованием производных единиц
(Из расстояния и времени вычисляем скорость, а затем снова расстояние):
    
    >>=90km
    90.0/1 km
    >>/1hr, 30min
    1.0/1 km/min
    >>*45min
    45.0/1 min*km/min
    >>fold
    45.0/1 km

#### использование составных единиц

(на примере лошадиной силы, соотносящейся с ваттом, 
который последовательно выражается через джоули, ньютоны -
пока не превращается в набор базовых килограммов, метров и секунд).
Посчитана сила, как результат деления мощности на скорость 
(скорость для большей интриги выражена в узлах):

    >>=1hp
    1.0/1 hp
    >>/1kn
    1.0/1 hp/kn
    >>conv
    735.399/800 hr*кг*м*метр/n.mile*с:2*секунда
    >>fold
    1429.2575/3704 кг*м/с:2
    >>conv N
    не конвертировано:  0.0/1
    1429.2575/3704 N
    >>dec
    1429.6951943844492 N

## А что с делением?

Вообще, полноценное деление на смешанное число 
также должно приводить к появлению новых размерностей,
и можно также прийти к выводу, что такая операция *запрещена*.

Но поскольку ранее мы определили операцию умножения смешанного числа на обычное, 
результатом которого является число смешанное,
то мы должны определить и обратные операции.

Одна из них уже определена - 
при делении смешанного числа на обычное число - получается смешанное число.

Вторая операция должна позволять делить смешанное число на смешанное
и получать в итоге число обычное.
Фактически, отвечать на вопрос, **сколько раз** одно смешанное число **"помещается"** в другом.

Вот здесь как раз конвертация и оказывается нужной:
правильно поделить часы на секунды возможно только если задано отношение секунд к часам.

Хотя, вовсе не обязательно, чтобы **все** единицы смешанного числа имели соотношение друг с другом.
Какое-то число раз в делимом может помещаться весь набор единиц делителя. 
Безусловно, часто будет встречаться ситуация, когда "разноименность" единиц делимого и делителя будет приводить к невозможности полного деления - 
и в этом случае наше деление будет похоже на деление с остатком.

С той разницей, что результат не обязательно будет целочисленный,
но обязательно безразмерный (обычное число),
а в остаток будут помещаться нераспределившиеся размерности.

## О сравнимости чисел

Говорить о сравнении смешанных чисел друг с другом и с нулем в частности
однозначно не получится.

Говорить о положительности или отрицательности смешанного числа
(о сравнимости с нулем),
по-видимому, совсем не приходится.

Как минимум, если части числа не соотносятся между собой - мы ничего не можем сказать о его общем знаке.

И даже если все части числа могут быть приведены к одной единице - 
мы можем говорить о ее знаке только с тем уточнением, 
что этот вывод делается только для текущего состава соотношений.

Ряд размерностей всегда может быть расширен новым соотношением, 
и не исключено, что это соотношение будет отрицательным.

Примерно по тем же соображениям, в общем, невозможно говорить 
об абсолютной сравнимости чисел между собой.

Однако, с допущением  - "для текущего состояния" -
можно делать такие попытки.

В этом случае, часть сравнений, даже для несоотносящихся между собой единиц,
может дать определенный результат:
1. оно смешанное число может быть равным другому, если
    1. все его единицы могут быть приведены к одному набору единиц
    2. численные значения соответствующих частей результатов буду равны
2. число может быть больше или меньше другого, 
если все его части находятся "по одну сторону" (положительную или отрицательную)
от соответствующих частей другого числа.

В остальных случаях, к сожалению, результат сравнения не определен.

# Использование демо

Демо представляет собой простой однорегистровый калькулятор с последовательным вводом.

Чтобы начать вычислять,
вводите числа, используя формат представления дробей

(испольуются настройки, указанные в файле `demo.bat`)

## Сложение:

    >>=12hr,59min,30sec
    12.0/1 hr, 59.0/1 min, 30.0/1 sec
    >>+ 1 hr, 5 min, -40sec
    13.0/1 hr, 64.0/1 min, -10.0/1 sec
    >>- - 14 hr , 2     min    ,   5 sec
    27.0/1 hr, 62.0/1 min, -15.0/1 sec

если представление не очень удобно, проведите конвертацию:

    >>conv hr, min, sec
    28.0/1 hr, 1.0/1 min, 45.0/1 sec

	
состав и порядок, в котором задаются единицы при конвертации, важен

    >>conv min, hr
    1681.0/1 min, 0.1/80 hr

## Умножение:

    >>=6 фут, 6 дюйм
    6.0/1 фут, 6.0/1 дюйм
    >>*3
    18.0/1 фут, 18.0/1 дюйм
    >>/10
    Остаток:  0.0/1
    1.4/5 фут, 1.4/5 дюйм

результат можно представить в десятичном виде

    >>dec
    1.8 фут, 1.8 дюйм

и просто в привычных метрах

    >>conv m
    0.14859/25000 m
    >>dec
    0.59436 m

## Деление на смешанное число:

>>Обратите внимание, для деления здесь использована двойная косая черта //

разложим наши 6 футов и 30 экю
в наборы по 4 экю и 2 фута

(замечу, что я по прежнему ничего не знаю о соотношении экю и фунта;
более того, демонстрационные настройки (`demo.bat`) - ничего не знают об экю)

    >>=6 фут, 30 экю
    6.0/1 фут, 30.0/1 экю
    >>//4 экю, 2 фут
    Остаток:  18.0/1 экю
    3.0/1

итого три набора.

проверка:

    >>*4экю, 2 фут
    12.0/1 экю, 6.0/1 фут
    >>+18экю
    30.0/1 экю, 6.0/1 фут

    >>comp 6фут,30экю
    6.0/1 фут, 30.0/1 экю
    Числа равны

Кстати, что там с оплатой легионеров?

(здесь понадобятся настройки из `money.bat`)

Общая численность войска мне неизвестна, но в общем, можно сказать, что всадник обходится в:

    >>=1 денарий
    1.0/1 денарий
    >>//3.1/3 асс    
    Остаток:  0.0/1
    4.4/5

раза дороже обычного воина.

# О комбинаторике

Главная часть конвертера - таблица соотношений между единицами.
Каждое новое соотношение встравивает очередную единицу в один из сетов (рядов, линеек) единиц
и задает производные соотношения новой единицы со всеми прочими единицами сета.
Таким образом, для исходной линейки связанных между собой единиц длины N
будет задано N(N-1) = N^2^-N производных записей 
(исключаются записи соотношения единицы между самой собой).

# Состав проекта

Главная часть:

`mixednum.py` классы для работы со смешанными числами (само число и конвертер)

`mixedstr.py` класс для преобразования в/из строки

классы смешанных чисел используют соответствующие классы для работы с рациональными дробями:

`rationals.py` сами рациональные дроби

`ratiostr.py` строковое преобразование

необходимы для демо:

`simpleini.py`

`simpletab.py`

`fracdemo.py` демо-калькулятор дробей

(запуск:

    fracdemo.py ./conf/frac.cfg
)

`demo.py` основное демо

пакетные файлы команд для `demo.py`:

`demo.bat` - подключаются разнообразные единицы времени, 
стандартные и экзотические, 
очень большие (индуистский цикл Вселенной = 622080 млрд.лет) 
и очень маленькие (~~древне-еврейское мгновение *регаим* 5/114~~
терция 1/60 секунды);
а также единицы длины (метр, световой год и британская шкала)

`money.bat` - пистоли и гинеи, сестерции и тетрадрахмы, и *деньги* с алтынами

в каталоге `conf` отдельные файлы `*.tab` с таблицами соотношений.

# PS

Этот проект  исходно написан на другом языке. Порт на Python делается в целях обучения Python'у.

В частности, это объясняет то, что для работы с дробями написан свой свой собственный модуль вместо использования готового fractions:
в языке исходного проекта готовый модуль отсутствовал, пришлось писать самостоятельно;
а при переносе на python жаль было терять материал для обучения.
